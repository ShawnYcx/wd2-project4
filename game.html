<!DOCTYPE html>
<html>


<head>
	<title> Pong </title>
	<link href="css/styles.css" rel="stylesheet">
	<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
	<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
	
</head>

<body onload="setup()">
<canvas id="canvas" width="500" height="375" tabeindex='1'>Your browser doesn't support Canvas</canvas>
<audio preload="true" id="collide">
	<source src="http://dl.dropbox.com/u/26141789/canvas/pingpong/Metal%20Cling%20-%20Hit.mp3" />
	<source src="http://dl.dropbox.com/u/26141789/canvas/pingpong/Metal%20Cling%20-%20Hit.wav" />
</audio>

</body>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script>
	function setup() {

		var socket = io();
		var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');
        var H = canvas.height;
        var W = canvas.width;
        var raf;
        var velocity_array = [-8,-6,-5-4,-3,3,4,5,6,8];
        var rand_velo_x = velocity_array[Math.floor(Math.random() * velocity_array.length)];
        var rand_velo_y = velocity_array[Math.floor(Math.random() * velocity_array.length)];


        ball = {
          x: W/2,
          y: H/2, 
          r: 7,
          c: "black",
          vx: rand_velo_x,
          vy: rand_velo_y,
          
          // Function for drawing ball on canvas
          draw: function() {
            context.beginPath();
            context.fillStyle = this.c;
            context.arc(this.x, this.y, this.r, 0, Math.PI*2, false);
            context.fill();
          }
        };

        var paddle = {
          x: -10,
          y: 10,
          vx: 0,
          vy: 0,
          draw: function() {
          	//context.clearRect(0,0, canvas.width, canvas.height);
          	context.beginPath();
            context.rect(this.x, this.y, 175, 20);
            context.stroke();
            context.closePath();

            //context.restore();
          }
        };
        var paddle2 = {
          x: 5,
          y: H - 30,
          vx: 0,
          vy: 0,
          draw: function() {
            //context.clearRect(0,0, canvas.width, canvas.height);
            context.beginPath();
            context.rect(this.x, this.y, 175, 20);
            context.stroke();
            context.closePath();

            //context.restore();
          }
        };

        // socket.on('start', function(start) {
        // 	//stuff
        // });


        raf = window.requestAnimationFrame(draw);

        function draw() {
          context.clearRect(0,0, canvas.width, canvas.height);
 
            paddle.draw();
            paddle2.draw();
            ball.draw();
            raf = window.requestAnimationFrame(draw);

        }

        canvas.addEventListener( "mousemove", doMouseMove, true);

        function doMouseMove(e)
        {
        	paddle.x = e.x;
        	socket.emit('movePaddle', paddle);
        	//paddle.draw();

        }

        socket.on('updatePaddles', function(msg) 
        {
			   paddle.x = msg.x;
        	paddle.draw();
        })
        	
        

	}

	//on start

	//on mouse move
	//add a canvas event listener for mousemove


	//
	</script>
</html>